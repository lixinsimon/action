{mb tou}
<style>
html,
body {
    background-color: #efeff4;
}

.mui-bar~.mui-content .mui-fullscreen {
    top: 44px;
    height: auto;
}

.mui-pull-top-tips {
    position: absolute;
    top: -20px;
    left: 50%;
    margin-left: -25px;
    width: 40px;
    height: 40px;
    border-radius: 100%;
    z-index: 1;
}

.mui-bar~.mui-pull-top-tips {
    top: 24px;
}

.mui-pull-top-wrapper {
    width: 42px;
    height: 42px;
    display: block;
    text-align: center;
    background-color: #efeff4;
    border: 1px solid #ddd;
    border-radius: 25px;
    background-clip: padding-box;
    box-shadow: 0 4px 10px #bbb;
    overflow: hidden;
}

.mui-pull-top-tips.mui-transitioning {
    -webkit-transition-duration: 200ms;
    transition-duration: 200ms;
}

.mui-pull-top-tips .mui-pull-loading {
    /*-webkit-backface-visibility: hidden;
            -webkit-transition-duration: 400ms;
            transition-duration: 400ms;*/
    margin: 0;
}

.mui-pull-top-wrapper .mui-icon,
.mui-pull-top-wrapper .mui-spinner {
    margin-top: 7px;
}

.mui-pull-top-wrapper .mui-icon.mui-reverse {
    /*-webkit-transform: rotate(180deg) translateZ(0);*/
}

.mui-pull-bottom-tips {
    text-align: center;
    background-color: #efeff4;
    font-size: 15px;
    line-height: 40px;
    color: #777;
}

.mui-pull-top-canvas {
    overflow: hidden;
    background-color: #fafafa;
    border-radius: 40px;
    box-shadow: 0 4px 10px #bbb;
    width: 40px;
    height: 40px;
    margin: 0 auto;
}

.mui-pull-top-canvas canvas {
    width: 40px;
}

.mui-slider-indicator.mui-segmented-control {
    background-color: #efeff4;
}

.mui-control-item.jibie {
    line-height: 54px;
}

.mui-segmented-control.mui-scroll-wrapper {
    height: 54px;
    line-height: 54px;
}

.mui-fullscreen .mui-segmented-control~.mui-slider-group {
    top: 53px;
}

.mui-segmented-control.mui-scroll-wrapper .mui-scroll {
    border-bottom: none;
}

.mui-segmented-control.mui-scroll-wrapper .mui-scroll .mui-control-item.mui-active {
    height: 54px;
    border-bottom: 2px solid #ff5234;
    color: #ff5234;
}

.mui-row.mui-fullscreen>[class*="mui-col-"] {
    height: 100%;
}

.mui-col-xs-3,
.mui-control-content {
    overflow-y: auto;
    height: 80%;
}

.mui-segmented-control .mui-control-item {
    line-height: 50px;
    width: 100%;
}

.mui-pull-bottom-pocket,
.mui-pull-top-pocket {
    height: 25px;
}

.mui-pull {
    bottom: 0px;
}

.mui-pull-top-pocket {
    top: -20px;
    margin-top: -30px;
}

.mui-ellipsis-3 {
    display: -webkit-box;
    overflow: hidden;
    white-space: normal !important;
    text-overflow: ellipsis;
    word-wrap: break-word;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
}
</style>
<header class="mui-bar mui-bar-nav">
    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left back"></a>
    <h1 class="mui-title">新闻列表</h1>
</header>
<div class="mui-content" style="margin-bottom: 51px;">
    <div id="slider" class="mui-slider mui-fullscreen">
        <div id="sliderSegmentedControl" class="mui-scroll-wrapper mui-slider-indicator mui-segmented-control mui-segmented-control-inverted" style="background:#fff;">
            <div class="mui-scroll">
                <?php $loop_index = 0; ?> {loop $fenlei $item}
                <a class="mui-control-item jibie {if $loop_index==0}mui-active{/if}" href="#item{$loop_index}mobile" data-type="{$item['id']}">{$item['ming']} </a>
                <?php $loop_index++;?> {/loop}
            </div>
        </div>
        <div class="mui-slider-group">
            <?php $loop_index = 0; ?>
            <div id="pullrefresh" class="mui-scroll-wrapper" style="margin-top:3px;">
                {loop $fenlei $item}
                <div id="item{$loop_index}mobile" class="mui-slider-item mui-control-content {if $loop_index==0}mui-active{/if}">
                    <!--下拉刷新容器-->
                    <div class="mui-scroll">
                        <!--数据列表-->
                        <ul class="mui-table-view" style="background:#fff;">
                            <!-- <li class="mui-table-view-cell mui-media">
                                <a href="{php echo UA('xinwen/xinwen-xq')}">
                                    <img class="mui-pull-left" src="{php echo JueDuiUrl('images/tongzhi_01.jpg')}" style="margin-left:0px;margin-right: 15px;width:70px;">
                                    <div class="mui-media-body" style="margin-left:15px;">
                                        <p class="mui-ellipsis-2" style="font-size:1.2em;color:#333;">水果是指且大多数有甜味可直接生吃的植物果实，不但含有丰富的营养且能不但含有丰富的营养且能不但含有丰富的营养且能</p>
                                        <span style="margin-top:5px;color:#999;display:block;">2017-02-08 15:30</span>
                                    </div>
                                </a>
                            </li> -->
                        </ul>
                    </div>
                </div>
                <?php $loop_index++;?> {/loop}
            </div>
        </div>
    </div>
</div>
<script type="text/javascript" charset="utf-8">

mui.init({
    pullRefresh: {
        container: "#pullrefresh", //下拉刷新容器标识，querySelector能定位的css选择器均可，比如：id、.class等
        down: {
            height: 50, //可选,默认50.触发下拉刷新拖动距离,
            //                              auto: true,//可选,默认false.自动下拉刷新一次
            contentdown: "下拉可以刷新", //可选，在下拉可刷新状态时，下拉刷新控件上显示的标题内容
            contentover: "释放立即刷新", //可选，在释放可刷新状态时，下拉刷新控件上显示的标题内容
            contentrefresh: "正在刷新...", //可选，正在刷新状态时，下拉刷新控件上显示的标题内容
            callback: function() {
                $(".mui-slider-item.mui-active ul").attr("data-ye", 1).html("");
                datapull($(".jibie.mui-active").attr('data-type'), $(".mui-slider-item.mui-active ul"), function() {
                    mui('#pullrefresh').pullRefresh().endPulldownToRefresh();
                });
                //                                  setTimeout(function(){
                //                                                          mui('#refreshContainer').pullRefresh().endPulldownToRefresh();
                //                                  }, 2000)
            },
        },
        up: {
            height: 50, //可选.默认50.触发上拉加载拖动距离
            auto: true, //可选,默认false.自动上拉加载一次
            contentrefresh: "正在加载...", //可选，正在加载状态时，上拉加载控件上显示的标题内容
            contentnomore: '没有更多数据了', //可选，请求完毕若没有更多数据时显示的提醒内容；
            callback: function() {
                datapull($(".jibie.mui-active").attr('data-type'), $(".mui-slider-item.mui-active ul"), function() {
                    mui('#pullrefresh').pullRefresh().endPullupToRefresh();
                });
            }
        }
    }
});
// datapull('{$item["id"]}', mui('#pullrefresh{$loop_index}'), yema{$loop_index}++);

/**
 * 下拉刷新具体业务实现
 */
// function pulldownRefresh() {
//     setTimeout(function() {
//         mui('#pullrefresh0').pullRefresh().endPulldownToRefresh(); //refresh completed
//     }, 1500);
// }
// var count = 0;
// /**
//  * 上拉加载具体业务实现
//  */
// function pullupRefresh() {
//     setTimeout(function() {
//         mui('#pullrefresh0').pullRefresh().endPullupToRefresh((++count > 2)); //参数为true代表没有更多数据了。
//         var table = document.body.querySelector('.mui-table-view');
//         var cells = document.body.querySelectorAll('.mui-table-view-cell');
//         for (var i = cells.length, len = i + 2; i < len; i++) {
//             var li = document.createElement('li');
//             li.className = 'mui-table-view-cell mui-media';
//             li.innerHTML = '<a href="{php echo UA('
//             xinwen / xinwen - xq ')}"><img class="mui-pull-left" src="{php echo JueDuiUrl('
//             images / tongzhi_01.jpg ')}" style="margin-left:0px;margin-right: 15px;width:70px;"><div class="mui-media-body" style="margin-left:15px;"><p class="mui-ellipsis-2" style="font-size:1.2em;color:#333;">水果是指且大多数有甜味可直接生吃的植物果实，不但含有丰富的营养且能不但含有丰富的营养且能不但含有丰富的营养且能</p><span style="margin-top:5px;color:#999;display:block;">2017-02-08 15:30</span></div></a>';
//             table.appendChild(li);
//         }

//     }, 1500);
// }
// if (mui.os.plus) {
//     mui.plusReady(function() {
//         setTimeout(function() {
//             mui('#pullrefresh0').pullRefresh().pullupLoading();
//         }, 1000);

//     });
// } else {
//     mui.ready(function() {
//         mui('#pullrefresh0').pullRefresh().pullupLoading();
//     });
// }

function datapull(type, target, ye) {
    $.post('{php echo UA("xinwen/index")}', {
        type: type,
        ye: ye
    }, function(shu) {
        var table = $(target).find('.mui-table-view');
        if (shu.shi == 1) {
            // for (var i = 0; i < shu.shu.length; i++) {
            //  var item = shu.shu[i];
            //     var li = document.createElement('li');
            //     li.className = 'mui-table-view-cell mui-media';
            //     li.innerHTML = '<a href="{php echo UA("xinwen/xinwen-xq")}"><img class="mui-pull-left" src="{php echo JueDuiUrl("images/tongzhi_01.jpg")}" style="margin-left:0px;margin-right: 15px;width:70px;"><div class="mui-media-body" style="margin-left:15px;"><p class="mui-ellipsis-2" style="font-size:1.2em;color:#333;">'+item.biaoti+'</p><span style="margin-top:5px;color:#999;display:block;">'+item.shijian+'</span></div></a>';
            //     table.append(li);
            // }
            table.append(shu.shu);
        }
        target.pullRefresh().endPullupToRefresh((shu.shi == 0));
    }, 'json');
}


$("#sliderSegmentedControl").on('tap', '.jibie', function(e) {
    var t = $(this);
    t.siblings().removeClass("mui-active");
    t.addClass("mui-active");
    $(".mui-slider-item").not(t.index()).removeClass('mui-active').hide();
    $(".mui-slider-item").eq(t.index()).addClass('mui-active').show();
    datapull($(this).attr('data-type'), $(".mui-slider-item.mui-active ul"), function(){});
    return false;
});
$(".mui-table-view").on('tap', 'li>a', function(e) {
    location.href = $(this).attr("href");
    e.stopPropagation();
    return false;
});
$(".mui-table-view").on('tap', 'li>a [data-xq]', function(e) {
    location.href = $(this).attr("data-xq");
    e.stopPropagation();
    return false;
});

function datapull(type, target, pullobj) {
    var ye = target.attr('data-ye') || "1";
    $.post('{php echo UA("xinwen/index")}', {
        type : type,
        ye : ye
    }, function(shu) {
        if (shu.shi == 1) {
            $(target).append(shu.shu);
            // target.attr('data-ye', ++ye);
        }
        pullobj();
    }, 'json');
}

</script>
{mb jiao}
